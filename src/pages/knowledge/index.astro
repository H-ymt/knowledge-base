---
import Layout from "../../layouts/Layout.astro";
import entriesData from "@/data/entries.json";
import type { KnowledgeEntry } from "@/lib/types";

const entries = (entriesData as KnowledgeEntry[]);
const pageSize = 20;
const pageEntries = entries.slice(0, pageSize);
const totalPages = Math.ceil(entries.length / pageSize);
---

<Layout>
  <section class="container mx-auto p-6 space-y-6">
    <header class="space-y-1">
      <h1 class="text-3xl">Knowledge</h1>
      <p class="text-sm text-main-body-lighter">{entries.length} 件</p>
    </header>

    <ul class="space-y-4">
      {pageEntries.map((e) => (
        <li class="border border-main-200 rounded-md p-4 hover:bg-main-25 transition">
          <a href={`/knowledge/${e.slug}`} class="block">
            <h2 class="text-xl mb-1">{e.title}</h2>
            <p class="text-sm mb-2 text-main-body-lighter">{new Date(e.publishedAt).toLocaleDateString("ja-JP")}</p>
            <p class="text-sm line-clamp-2">{e.summary}</p>
            <div class="mt-2 flex flex-wrap gap-2">
              {e.tags.slice(0, 6).map((t) => (
                <span class="text-xs px-2 py-0.5 rounded-full bg-main-50 text-main-700">{t.norm}</span>
              ))}
            </div>
          </a>
        </li>
      ))}
    </ul>

    {totalPages > 1 && (
      <nav class="flex items-center justify-end gap-2 text-sm">
        <a class="px-3 py-1 rounded border border-main-300 hover:bg-main-50" href="/knowledge/page/2">次のページ →</a>
      </nav>
    )}
  </section>
</Layout>

